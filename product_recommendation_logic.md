# 제품 추천 로직 및 우선순위 상세 분석

## 🎯 전체 추천 시스템 개요

### 1. 기본 구조
- **총 7개 제품 추천**: 기본 베이스 제품 3개 + 보강 제품 4개
- **점수 기반 순위**: 각 제품에 final_score를 부여하여 상위 7개 선택
- **건강지표 우선**: 건강지표 매칭을 최우선으로 하고, 관리영역 매칭은 보조적 역할

## 🏆 점수 계산 시스템

### 정확한 매칭 (Exact Match)
```
final_score = 10000 + (매칭개수 × 1000) + (조합보너스) + (관리영역점수)
```
- **기본 점수**: 10,000점 (정확한 매칭 보너스)
- **매칭 개수**: 건강지표 매칭 개수 × 1,000점
- **조합 보너스**: (10 - 조합크기) × 100점 (작은 조합일수록 높은 점수)
- **관리영역 점수**: 사용자 선택 영역과의 매칭 개수

### 부분 매칭 (Partial Match)
```
final_score = (매칭개수 × 100) + (관리영역점수)
```
- **매칭 개수**: 건강지표 매칭 개수 × 100점
- **관리영역 점수**: 사용자 선택 영역과의 매칭 개수

## 📊 구체적인 우선순위 로직

### 1단계: 건강지표 매칭 우선순위
1. **정확한 매칭 (Exact Match)** - 최고 우선순위
   - 사용자의 건강지표가 제품의 건강지표 조합에 완전히 포함되는 경우
   - 예: 사용자 [노화억제, 만성질환] → 제품 [노화억제, 만성질환] ✅

2. **부분 매칭 (Partial Match)** - 낮은 우선순위
   - 사용자의 건강지표 중 일부만 매칭되는 경우
   - 예: 사용자 [노화억제, 만성질환, 근육밸런스] → 제품 [노화억제] ✅

### 2단계: 매칭 개수 비교
- 같은 매칭 유형 내에서 더 많은 건강지표와 매칭되는 제품이 우선
- 예: 2개 매칭 > 1개 매칭

### 3단계: 조합 크기 비교 (정확한 매칭에서만)
- 같은 매칭 개수라면 더 작은 조합 크기가 우선
- 예: [노화억제, 만성질환] > [노화억제, 만성질환, 근육밸런스]
- 이유: 더 집중적이고 특화된 제품으로 판단

### 4단계: 관리영역 매칭 (보조 점수)
- 사용자가 선택한 인체생리네트워크 및 건강분야와의 매칭
- 주요 점수에 비해 매우 낮은 가중치 (1점씩 추가)

## 🔢 점수 예시

### 시나리오: 사용자 건강지표 [노화억제, 만성질환]

| 제품 | 건강지표 조합 | 매칭유형 | 매칭개수 | 조합크기 | 관리영역 | 최종점수 | 순위 |
|------|---------------|----------|----------|----------|----------|----------|------|
| 제품A | [노화억제, 만성질환] | 정확 | 2 | 2 | 3 | 18,803 | 1위 |
| 제품B | [노화억제, 만성질환, 근육] | 정확 | 2 | 3 | 2 | 18,702 | 2위 |
| 제품C | [노화억제] | 정확 | 1 | 1 | 4 | 11,904 | 3위 |
| 제품D | [노화억제, 근육, 면역] | 부분 | 1 | - | 2 | 102 | 4위 |

## 🎯 기본 베이스 vs 보강 제품 구분

### 기본 베이스 제품 (1-3위)
- **최고 점수 상위 3개 제품**
- 사용자의 핵심 건강 문제를 직접적으로 해결
- 건강지표 매칭이 가장 우수한 제품들
- 필수적으로 섭취해야 할 제품으로 분류

### 보강 제품 (4-7위)
- **4-7위 제품들**
- 기본 베이스를 보완하는 역할
- 추가적인 건강 효과나 특화된 기능 제공
- 사용자의 관심 영역이나 부가적인 건강 관리에 도움

## 🔍 보강 제품 선정의 세부 로직

### 1. 점수 기반 자동 선정
- 전체 7개 제품 중 4-7위에 해당하는 제품들
- 기본 베이스와 동일한 점수 계산 방식 적용
- 별도의 보강 제품 전용 로직은 없음

### 2. 보강 제품의 특징
- **다양성 확보**: 기본 베이스와 다른 건강 영역 커버
- **특화 기능**: 특정 관리영역에 특화된 제품들
- **부가 효과**: 기본 베이스의 효과를 증대시키는 제품들

### 3. 실제 선정 과정
1. 모든 제품에 대해 동일한 점수 계산
2. 점수 순으로 정렬
3. 상위 7개 선택
4. 1-3위를 기본 베이스로 분류
5. 4-7위를 보강 제품으로 분류

## 📈 점수 분포 특성

### 정확한 매칭 제품들
- **점수 범위**: 10,000점 이상
- **일반적 점수**: 11,000 ~ 20,000점
- **최고 점수**: 건강지표 3개 정확 매칭 + 작은 조합 + 관리영역 매칭

### 부분 매칭 제품들
- **점수 범위**: 100 ~ 1,000점
- **보강 제품 가능성**: 높음 (정확한 매칭 제품이 3개 미만인 경우)

## 🎪 특수 상황 처리

### 모든 건강지표가 '좋음'인 경우
- 건강지표 매칭 대신 관리영역 매칭만 사용
- 인체생리네트워크 매칭에 높은 가중치 (×10)
- 건강분야 매칭에 중간 가중치 (×5)
- 예방 및 건강 유지 목적의 제품 추천

## 💡 보강 제품 추천의 의미

보강 제품은 단순히 "4등 제품"이 아니라:
1. **기본 베이스 보완**: 핵심 건강 문제 해결 후 추가 관리
2. **특화 기능 제공**: 특정 영역에 특화된 전문적 관리
3. **시너지 효과**: 기본 베이스와 함께 섭취 시 상승 효과
4. **개인 맞춤**: 사용자의 관심 영역과 생활 패턴 고려

이러한 체계적인 로직을 통해 사용자에게 과학적이고 개인화된 제품 추천을 제공합니다.